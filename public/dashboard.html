<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作台 - WMS仓库管理系统</title>
    <!-- 引入Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.2/dist/index.css">
    <!-- 引入Vue 3 -->
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
    <!-- 引入Element Plus JS -->
    <script src="https://unpkg.com/element-plus@2.4.2/dist/index.full.js"></script>
    <!-- 引入Element Plus 中文语言包 -->
    <script src="https://unpkg.com/element-plus@2.4.2/dist/locale/zh-cn.js"></script>
    <!-- 引入Chart.js用于图表展示 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .content-wrapper {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background-color: #f5f5f5;
        }
        /* 一级菜单默认靠左 */
        .el-menu-item {
            text-align: left !important;
            height: 45px !important;
            line-height: 45px !important;
            font-size: 14px !important;
        }
        /* 一级菜单标题高度和对齐 */
        .el-sub-menu .el-sub-menu__title {
            text-align: left !important;
            height: 45px !important;
            line-height: 45px !important;
            font-size: 14px !important;
        }
        /* 二级菜单默认靠右缩进10个像素 */
        .el-sub-menu__children {
            padding-left: 0 !important;
            padding-right: 10px !important;
            text-align: right;
        }
        /* 一级菜单图标使用白色 */
        .el-menu-vertical-demo .el-icon {
            color: white !important;
        }
        /* 数据卡片样式 */
        .icon-card {
            text-align: center;
            padding: 5px 10px;
            height: 90px !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        .icon-card:hover {
            transform: translateY(-2px);
        }
        /* 趋势指标样式 */
        .trend {
            display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px;
        }
        .trend-up {
            background-color: rgba(76, 175, 80, 0.1); color: #4CAF50;
        }
        .trend-down {
            background-color: rgba(244, 67, 54, 0.1); color: #F44336;
        }
        /* 图表容器样式 */
        .chart-container {
            position: relative; height: 300px; margin: 10px 0;
        }
        /* 小表格样式 */
        .small-table {
            margin-bottom: 10px;
        }
        .small-table .el-card__header {
            padding: 8px 10px;
        }
        .small-table .el-table {
            font-size: 12px;
        }
        .small-table .el-table__header-wrapper th {
            padding: 6px 0;
        }
        .small-table .el-table__body-wrapper td {
            padding: 8px 0;
            white-space: nowrap;
        }
        .order-no-column {
            min-width: 140px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-container class="container">
            <!-- 侧边栏菜单 -->
            <el-aside width="200px" style="background-color: #000; color: white; height: 100vh;">
                <div style="padding: 20px; text-align: center; border-bottom: 1px solid #34495e;">
                    <h2 style="color: white; margin: 0;">WMS仓库管理系统</h2>
                </div>
                <el-menu
                    :default-openeds="[]"
                    :default-active="activeMenu"
                    class="el-menu-vertical-demo"
                    background-color="transparent"
                    text-color="white"
                    active-text-color="#4CAF50"
                    @select="handleMenuSelect"
                    :unique-opened="true"
                >
                    <el-menu-item index="dashboard">
                        <el-icon><el-icon-location /></el-icon>
                        <span>工作台</span>
                    </el-menu-item>
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><el-icon-upload /></el-icon>
                            <span>入库管理</span>
                        </template>
                        <el-menu-item index="srm-purchase">SRM采购单</el-menu-item>
                        <el-menu-item index="incoming-order">入库订单</el-menu-item>
                        <el-menu-item index="incoming-inspection">入库质检</el-menu-item>
                    </el-sub-menu>
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><el-icon-download /></el-icon>
                            <span>出库管理</span>
                        </template>
                        <el-menu-item index="outgoing-order">出库订单</el-menu-item>
                        <el-menu-item index="picking-task">拣货任务</el-menu-item>
                    </el-sub-menu>
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><el-icon-sold-out /></el-icon>
                            <span>库存管理</span>
                        </template>
                        <el-menu-item index="inventory-query">库存查询</el-menu-item>
                        <el-menu-item index="inventory-freeze">库存冻结</el-menu-item>
                    </el-sub-menu>
                    <el-sub-menu index="4">
                        <template #title>
                            <el-icon><el-icon-document /></el-icon>
                            <span>盘点管理</span>
                        </template>
                        <el-menu-item index="checking-list">盘点单</el-menu-item>
                    </el-sub-menu>
                    <el-sub-menu index="5">
                        <template #title>
                            <el-icon><el-icon-sunrise /></el-icon>
                            <span>基础数据</span>
                        </template>
                        <el-menu-item index="warehouse">仓库管理</el-menu-item>
                        <el-menu-item index="goods">货品管理</el-menu-item>
                    </el-sub-menu>
                    <el-sub-menu index="6">
                        <template #title>
                            <el-icon><el-icon-setting /></el-icon>
                            <span>系统管理</span>
                        </template>
                        <el-menu-item index="users">用户管理</el-menu-item>
                        <el-menu-item index="roles">角色管理</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </el-aside>
            
            <!-- 主内容区 -->
            <el-container class="main-content">
                <!-- 顶部导航栏 - 改为黑色 -->
                <el-header style="background-color: #000; padding: 0 20px; border-bottom: 1px solid #333;">
                    <div style="display: flex; justify-content: space-between; align-items: center; height: 100%;">
                        <h1 style="margin: 0; font-size: 20px; color: white;">{{ pageTitle }}</h1>
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 20px; color: #ddd;">欢迎，{{ username }}</span>
                            <el-button type="danger" @click="handleLogout">退出登录</el-button>
                        </div>
                    </div>
                </el-header>
                
                <!-- 内容区域 -->
                <el-main class="content-wrapper">
                    <!-- 数据概览卡片 - 带环比趋势 -->
                    <el-row :gutter="10" style="margin-bottom: 10px;">
                        <el-col :xs="24" :sm="12" :lg="6">
                            <el-card shadow="hover" class="icon-card">
                                <div style="text-align: left;">
                                    <div style="font-size: 14px; color: #666;">待入库订单</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #333; margin-top: 2px;">89</div>
                                </div>
                                <div class="trend trend-up">+12% 较昨日</div>
                            </el-card>
                        </el-col>
                        <el-col :xs="24" :sm="12" :lg="6">
                            <el-card shadow="hover" class="icon-card">
                                <div style="text-align: left;">
                                    <div style="font-size: 14px; color: #666;">待上架任务</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #333; margin-top: 2px;">45</div>
                                </div>
                                <div class="trend trend-down">-5% 较昨日</div>
                            </el-card>
                        </el-col>
                        <el-col :xs="24" :sm="12" :lg="6">
                            <el-card shadow="hover" class="icon-card">
                                <div style="text-align: left;">
                                    <div style="font-size: 14px; color: #666;">待出库订单</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #333; margin-top: 2px;">124</div>
                                </div>
                                <div class="trend trend-up">+8% 较昨日</div>
                            </el-card>
                        </el-col>
                        <el-col :xs="24" :sm="12" :lg="6">
                            <el-card shadow="hover" class="icon-card">
                                <div style="text-align: left;">
                                    <div style="font-size: 14px; color: #666;">待拣货任务</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #333; margin-top: 2px;">67</div>
                                </div>
                                <div class="trend trend-up">+15% 较昨日</div>
                            </el-card>
                        </el-col>
                    </el-row>
                    
                    <!-- 30天出入库趋势图 -->
                    <el-card shadow="hover">
                        <template #header>
                            <div style="font-size: 16px; font-weight: 500;">30天出入库趋势</div>
                        </template>
                        <div class="chart-container">
                            <canvas id="inventoryTrendChart"></canvas>
                        </div>
                    </el-card>
                    
                    <!-- 待处理订单列表 -->
                    <el-row :gutter="10" style="margin-top: 10px;">
                        <!-- 待入库订单列表 -->
                        <el-col :xs="24" :md="8">
                            <el-card shadow="hover" class="small-table">
                                <template #header>
                                    <div style="font-size: 13px; font-weight: 500;">待入库订单</div>
                                </template>
                                <el-table :data="pendingIncomingOrders" size="small" style="width: 100%;">
                                    <el-table-column prop="orderNo" label="订单号" class-name="order-no-column"></el-table-column>
                                    <el-table-column prop="supplier" label="供应商" width="80"></el-table-column>
                                    <el-table-column prop="amount" label="数量" width="60"></el-table-column>
                                </el-table>
                            </el-card>
                        </el-col>
                        
                        <!-- 待出库订单列表 -->
                        <el-col :xs="24" :md="8">
                            <el-card shadow="hover" class="small-table">
                                <template #header>
                                    <div style="font-size: 13px; font-weight: 500;">待出库订单</div>
                                </template>
                                <el-table :data="pendingOutgoingOrders" size="small" style="width: 100%;">
                                    <el-table-column prop="orderNo" label="订单号" class-name="order-no-column"></el-table-column>
                                    <el-table-column prop="customer" label="客户" width="80"></el-table-column>
                                    <el-table-column prop="amount" label="数量" width="60"></el-table-column>
                                </el-table>
                            </el-card>
                        </el-col>
                        
                        <!-- 待盘点订单列表 -->
                        <el-col :xs="24" :md="8">
                            <el-card shadow="hover" class="small-table">
                                <template #header>
                                    <div style="font-size: 13px; font-weight: 500;">待盘点订单</div>
                                </template>
                                <el-table :data="pendingCheckingOrders" size="small" style="width: 100%;">
                                    <el-table-column prop="orderNo" label="盘点单号" class-name="order-no-column"></el-table-column>
                                    <el-table-column prop="warehouse" label="仓库" width="80"></el-table-column>
                                    <el-table-column prop="status" label="状态" width="60"></el-table-column>
                                </el-table>
                            </el-card>
                        </el-col>
                    </el-row>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <script>
        // 定义Element Plus图标
        const { createApp, ref, reactive, onMounted } = Vue
        const { 
            ElContainer, ElAside, ElHeader, ElMain, ElMenu, ElSubMenu, 
            ElMenuItem, ElIcon, ElCard, ElRow, ElCol, ElTable, ElTableColumn, 
            ElButton, ElMessage 
        } = ElementPlus
        
        // 手动定义需要的Element Plus图标组件
        const ElIconLocation = { template: '<i class="el-icon-location"></i>' }
        const ElIconUpload = { template: '<i class="el-icon-upload"></i>' }
        const ElIconDownload = { template: '<i class="el-icon-download"></i>' }
        const ElIconSoldOut = { template: '<i class="el-icon-sold-out"></i>' }
        const ElIconDocument = { template: '<i class="el-icon-document"></i>' }
        const ElIconSunrise = { template: '<i class="el-icon-sunrise"></i>' }
        const ElIconSetting = { template: '<i class="el-icon-setting"></i>' }
        const ElIconBox = { template: '<i class="el-icon-box"></i>' }
        
        createApp({
            components: {
                ElContainer,
                ElAside,
                ElHeader,
                ElMain,
                ElMenu,
                ElSubMenu,
                ElMenuItem,
                ElIcon,
                ElIconLocation,
                ElIconUpload,
                ElIconDownload,
                ElIconSoldOut,
                ElIconDocument,
                ElIconSunrise,
                ElIconSetting,
                ElIconBox,
                ElCard,
                ElRow,
                ElCol,
                ElTable,
                ElTableColumn,
                ElButton
            },
            setup() {
                const activeMenu = ref('dashboard')
                const pageTitle = ref('工作台')
                const username = ref('guest')
                
                // 待入库订单数据
                const pendingIncomingOrders = reactive([
                    { orderNo: 'RK20231121001', supplier: '供应商A', amount: 150 },
                    { orderNo: 'RK20231121002', supplier: '供应商B', amount: 89 },
                    { orderNo: 'RK20231121003', supplier: '供应商C', amount: 210 },
                    { orderNo: 'RK20231121004', supplier: '供应商A', amount: 67 }
                ])
                
                // 待出库订单数据
                const pendingOutgoingOrders = reactive([
                    { orderNo: 'CK20231121001', customer: '客户X', amount: 124 },
                    { orderNo: 'CK20231121002', customer: '客户Y', amount: 95 },
                    { orderNo: 'CK20231121003', customer: '客户Z', amount: 180 },
                    { orderNo: 'CK20231121004', customer: '客户X', amount: 76 }
                ])
                
                // 待盘点订单数据
                const pendingCheckingOrders = reactive([
                    { orderNo: 'PD20231121001', warehouse: '主仓库', status: '待盘' },
                    { orderNo: 'PD20231121002', warehouse: '副仓库', status: '待盘' },
                    { orderNo: 'PD20231121003', warehouse: '主仓库', status: '待盘' },
                    { orderNo: 'PD20231121004', warehouse: '危险品库', status: '待盘' }
                ])
                
                // 菜单选择处理
                const handleMenuSelect = (index) => {
                    activeMenu.value = index
                    // 更新页面标题
                    const menuMap = {
                        'dashboard': '工作台',
                        'srm-purchase': 'SRM采购单',
                        'incoming-order': '入库订单',
                        'incoming-inspection': '入库质检',
                        'outgoing-order': '出库订单',
                        'picking-task': '拣货任务',
                        'inventory-query': '库存查询',
                        'inventory-freeze': '库存冻结',
                        'checking-list': '盘点单',
                        'warehouse': '仓库管理',
                        'goods': '货品管理',
                        'users': '用户管理',
                        'roles': '角色管理'
                    }
                    pageTitle.value = menuMap[index] || '工作台'
                }
                
                // 退出登录
                const handleLogout = () => {
                    // 清除token
                    localStorage.removeItem('token')
                    localStorage.removeItem('username')
                    // 重定向到登录页面
                    window.location.href = '/login.html'
                }
                
                // 检查登录状态
                const checkLogin = () => {
                    const token = localStorage.getItem('token')
                    // 如果有token，保持在当前页面；如果没有token，重定向到登录页面
                    if (!token) {
                        window.location.href = '/login.html'
                    } else {
                        // 登录成功后，获取用户名并显示
                        const savedUsername = localStorage.getItem('username')
                        if (savedUsername) {
                            username.value = savedUsername
                        }
                    }
                }
                
                // 生成30天日期标签
                const generateDateLabels = () => {
                    const labels = [];
                    const today = new Date();
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - i);
                        labels.push(`${date.getMonth() + 1}/${date.getDate()}`);
                    }
                    return labels;
                }
                
                // 生成随机出入库数据
                const generateInventoryData = () => {
                    const incoming = [];
                    const outgoing = [];
                    for (let i = 0; i < 30; i++) {
                        incoming.push(Math.floor(Math.random() * 100) + 50); // 50-150之间的随机数
                        outgoing.push(Math.floor(Math.random() * 120) + 60); // 60-180之间的随机数
                    }
                    return { incoming, outgoing };
                }
                
                // 初始化图表
                const initChart = () => {
                    const ctx = document.getElementById('inventoryTrendChart').getContext('2d');
                    const labels = generateDateLabels();
                    const { incoming, outgoing } = generateInventoryData();
                    
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: '入库量',
                                    data: incoming,
                                    backgroundColor: 'rgba(76, 175, 80, 0.6)',
                                    borderColor: 'rgba(76, 175, 80, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: '出库量',
                                    data: outgoing,
                                    backgroundColor: 'rgba(33, 150, 243, 0.6)',
                                    borderColor: 'rgba(33, 150, 243, 1)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: '日期'
                                    },
                                    ticks: {
                                        maxRotation: 45,
                                        minRotation: 45,
                                        maxTicksLimit: 10
                                    }
                                },
                                y: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: '数量'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
                
                // 页面加载时检查登录状态并初始化图表
                onMounted(() => {
                    checkLogin();
                    initChart();
                })
                
                return {
                    activeMenu,
                    pageTitle,
                    username,
                    pendingIncomingOrders,
                    pendingOutgoingOrders,
                    pendingCheckingOrders,
                    handleMenuSelect,
                    handleLogout
                }
            }
        }).use(ElementPlus, {
            locale: ElementPlusLocaleZhCn
        }).mount('#app')
    </script>
</body>
</html>